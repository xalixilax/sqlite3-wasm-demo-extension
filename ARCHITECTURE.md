# Architecture Overview

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           React App (Main Thread)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  App.tsx                                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  <QueryClientProvider>                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    <UserManager />                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      {                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        const { data, isLoading } = useUsers();         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚        const addUser = useAddUser();                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      }                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  </QueryClientProvider>                                â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ Type-safe hooks                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  workerClient.ts                                            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  useUsers() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  useAddUser() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  useUpdateUser() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  useDeleteUser() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                            â”‚                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  WorkerClient â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - Manages worker instance                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - Sends requests                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - Handles responses                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    - Promise-based API                                 â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ postMessage                           â”‚
â”‚                              â–¼                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                   ============â”‚============
                   Worker Boundary (IPC)
                   ============â”‚============
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              â”‚      Web Worker Thread                â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  worker.ts                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  addEventListener('message', async (event) => {        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    const request = event.data;                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    const response = await handleRequest(request);      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    postMessage(response);                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  });                                                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ Request                               â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  router.ts (createWorkerHandler)                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  1. Find route by name                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  2. Validate input with Zod schema                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  3. Call handler                                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  4. Catch errors                                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  5. Return response { success, data/error }            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ Route to handler                      â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  workerRoutes.ts (AppRouter)                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  createRouter({                                        â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    getUsers: query({                                   â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      handler: async () => db.select().from(users)      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    }),                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    addUser: mutation({                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      input: z.object({ name, email, age }),           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚      handler: async (input) => db.insert(users)...    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    }),                                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    updateUser: mutation({ ... }),                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚    deleteUser: mutation({ ... })                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  })                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â”‚ Database operations                   â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PGlite + Drizzle ORM                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚  - OPFS for persistence                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - SQL operations                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  - Type-safe queries                                   â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Request/Response Flow

### Query Example: `useUsers()`

```
Client                    Worker                    Database
  â”‚                         â”‚                          â”‚
  â”‚  1. useUsers()          â”‚                          â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                          â”‚
  â”‚  { id: "1",             â”‚                          â”‚
  â”‚    route: "getUsers",   â”‚                          â”‚
  â”‚    input: void }        â”‚                          â”‚
  â”‚                         â”‚                          â”‚
  â”‚                         â”‚  2. Validate input       â”‚
  â”‚                         â”‚     (no schema)          â”‚
  â”‚                         â”‚                          â”‚
  â”‚                         â”‚  3. Call handler         â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    â”‚
  â”‚                         â”‚  SELECT * FROM users     â”‚
  â”‚                         â”‚                          â”‚
  â”‚                         â”‚  4. Return rows          â”‚
  â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
  â”‚                         â”‚  [{ id: 1, name: ... }]  â”‚
  â”‚                         â”‚                          â”‚
  â”‚  5. Response            â”‚                          â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                          â”‚
  â”‚  { id: "1",             â”‚                          â”‚
  â”‚    success: true,       â”‚                          â”‚
  â”‚    data: [...] }        â”‚                          â”‚
  â”‚                         â”‚                          â”‚
  â”‚  6. Update cache        â”‚                          â”‚
  â”‚  7. Trigger re-render   â”‚                          â”‚
  â”‚                         â”‚                          â”‚
```

### Mutation Example: `addUser.mutate({ ... })`

```
Client                    Worker                    Database
  â”‚                         â”‚                          â”‚
  â”‚  1. addUser.mutate()    â”‚                          â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚                          â”‚
  â”‚  { id: "2",             â”‚                          â”‚
  â”‚    route: "addUser",    â”‚                          â”‚
  â”‚    input: {             â”‚                          â”‚
  â”‚      name: "John",      â”‚                          â”‚
  â”‚      email: "...",      â”‚                          â”‚
  â”‚      age: 30 }}         â”‚                          â”‚
  â”‚                         â”‚                          â”‚
  â”‚                         â”‚  2. Validate with Zod    â”‚
  â”‚                         â”‚     âœ“ name is string     â”‚
  â”‚                         â”‚     âœ“ email is valid     â”‚
  â”‚                         â”‚     âœ“ age is positive    â”‚
  â”‚                         â”‚                          â”‚
  â”‚                         â”‚  3. Call handler         â”‚
  â”‚                         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    â”‚
  â”‚                         â”‚  INSERT INTO users       â”‚
  â”‚                         â”‚  RETURNING *             â”‚
  â”‚                         â”‚                          â”‚
  â”‚                         â”‚  4. Return new user      â”‚
  â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
  â”‚                         â”‚  { id: 5, name: "John" } â”‚
  â”‚                         â”‚                          â”‚
  â”‚  5. Response            â”‚                          â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                          â”‚
  â”‚  { id: "2",             â”‚                          â”‚
  â”‚    success: true,       â”‚                          â”‚
  â”‚    data: { id: 5... }}  â”‚                          â”‚
  â”‚                         â”‚                          â”‚
  â”‚  6. Invalidate cache    â”‚                          â”‚
  â”‚  7. Refetch queries     â”‚                          â”‚
  â”‚  8. Trigger re-render   â”‚                          â”‚
  â”‚                         â”‚                          â”‚
```

## ğŸ“¦ Type Flow

```
workerRoutes.ts           router.ts              workerClient.ts
     â”‚                       â”‚                         â”‚
     â”‚  Define Routes        â”‚                         â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                         â”‚
     â”‚  â”‚ getUsers â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                         â”‚
     â”‚  â”‚  input?  â”‚        â”‚â”‚                         â”‚
     â”‚  â”‚  handler â”‚        â”‚â”‚                         â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚â”‚                         â”‚
     â”‚                      â”‚â”‚                         â”‚
     â”‚                      â”‚â”‚                         â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                         â”‚
     â”‚  export type          â”‚                         â”‚
     â”‚  AppRouter            â”‚                         â”‚
     â”‚                       â”‚                         â”‚
     â”‚                       â”‚  InferInput<T>          â”‚
     â”‚                       â”‚  InferOutput<T>         â”‚
     â”‚                       â”‚         â”‚               â”‚
     â”‚                       â”‚         â”‚               â”‚
     â”‚                       â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                       â”‚                         â”‚
     â”‚                       â”‚                  Type-safe hooks
     â”‚                       â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                       â”‚                    â”‚ useUsers â”‚
     â”‚                       â”‚                    â”‚  returns â”‚
     â”‚                       â”‚                    â”‚ User[] | â”‚
     â”‚                       â”‚                    â”‚undefined â”‚
     â”‚                       â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Full type safety from DB to UI
```

## ğŸ¯ Key Benefits

### 1. Type Safety
- Routes defined once in `workerRoutes.ts`
- Types automatically flow to client
- No manual type definitions needed
- Catch errors at compile time

### 2. Runtime Safety
- Zod validates all inputs
- Invalid data rejected before reaching handler
- Clear error messages

### 3. Developer Experience
- Autocomplete everywhere
- Inline documentation
- Easy to add new routes
- Similar to tRPC API

### 4. Performance
- Worker runs off main thread
- TanStack Query caching
- Automatic request deduplication
- Background refetching

### 5. Maintainability
- Single source of truth for routes
- Consistent error handling
- Easy to test
- Clear separation of concerns

## ğŸ”§ File Responsibilities

| File              | Purpose             | Modify?                       |
| ----------------- | ------------------- | ----------------------------- |
| `router.ts`       | Core infrastructure | âŒ No                          |
| `workerRoutes.ts` | Define routes       | âœ… Yes                         |
| `workerClient.ts` | Client hooks        | âœ… Yes (add convenience hooks) |
| `worker.ts`       | Worker setup        | âš ï¸ Rarely                      |
| `App.tsx`         | Use the hooks       | âœ… Yes                         |

---

**Understanding this architecture will help you build powerful type-safe applications! ğŸš€**
